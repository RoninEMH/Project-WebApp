@model IEnumerable<Shwallak.Models.Article>

@{
    ViewBag.Title = "SectionList";
    Layout = "~/Views/Shared/Readers_Layout.cshtml";
}

@{
    List<Shwallak.Models.Comment> popularComments = new List<Shwallak.Models.Comment>();

    foreach (Shwallak.Models.Article article in Model.ToList())
    {
        if (article.Comments != null)
        {
            foreach (Shwallak.Models.Comment comment in article.Comments.ToList())
            {
                popularComments.Add(comment);
            }
        }
    }

    popularComments.Sort(delegate (Shwallak.Models.Comment x, Shwallak.Models.Comment y)
    {
        return y.Watches - x.Watches;
    });
    int size = (int)Math.Ceiling(Model.ToList().Count / 3.0);
    if (popularComments.Count > size)
    {
        popularComments = popularComments.GetRange(0, size);
    }
}

<section id="contentSection">
    <div class="row">
        <div class="col-lg-8 col-md-8 col-sm-8">
            <div class="left_content">
                <div class="single_page">
                    <div class="related_post">
                        <h2>@ViewBag.Section</h2>

                        @{
                            List<Shwallak.Models.Article> articles = Model.ToList();
                            articles.Sort(delegate (Shwallak.Models.Article x, Shwallak.Models.Article y)
                            {
                                if (x.Year == y.Year)
                                {
                                    if (x.Month == y.Month)
                                    {
                                        return y.Day - x.Day;
                                    }
                                    else
                                        return y.Month - x.Month;
                                }
                                else
                                    return y.Year - x.Year;
                            });

                            int i;
                            string img = "/Content/images/" + @ViewBag.Section + "_section1.jpg";
                        }
                        @for (i = 0; articles.Count - 3 > i; i += 3)
                        {
                            Shwallak.Models.Article article1 = articles.ElementAt(i);
                            Shwallak.Models.Article article2 = articles.ElementAt(i + 1);
                            Shwallak.Models.Article article3 = articles.ElementAt(i + 2);

                            <ul class="spost_nav wow fadeInDown animated">
                                <li>
                                    <div class="media">
                                        <a class="media-left" href="~/Articles/Details/@article1.ArticleID">

                                            <img src=@img alt="">
                                        </a>
                                        <div class="media-body">
                                            <a class="catg_title" href="~/Articles/Details/@article1.ArticleID">@article1.Title </a>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="media">
                                        <a class="media-left" href="~/Articles/Details/@article2.ArticleID">
                                            <img src=@img alt="">
                                        </a>
                                        <div class="media-body">
                                            <a class="catg_title" href="~/Articles/Details/@article2.ArticleID">@article2.Title </a>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="media">
                                        <a class="media-left" href="~/Articles/Details/@article3.ArticleID">
                                            <img src=@img alt="">
                                        </a>
                                        <div class="media-body">
                                            <a class="catg_title" href="~/Articles/Details/@article3.ArticleID">@article3.Title </a>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        }

                        <ul class="spost_nav wow fadeInDown animated">
                            @while (i < articles.Count)
                            {
                                Shwallak.Models.Article article = articles.ElementAt(i);
                                <li>
                                    <div class="media">
                                        <a class="media-left" href="~/Articles/Details/@article.ArticleID">
                                            <img src=@img alt="">
                                        </a>
                                        <div class="media-body">
                                            <a class="catg_title" href="~/Articles/Details/@article.ArticleID">@article.Title </a>
                                        </div>
                                    </div>
                                </li>
                                i++;
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-4">
            <aside class="right_content">
                <div class="single_sidebar">
                    <h2><span>Popular Comments</span></h2>
                    <ul class="spost_nav">
                        @foreach (Shwallak.Models.Comment comment in popularComments)
                        {
                            <li>
                                <div class="media wow fadeInDown">
                                    <a href="~/Comments/Details/@comment.CommentID" class="media-left">
                                        <img src="~/Content/images/Comment.jpg" alt="">
                                    </a>
                                    <div class="media-body">
                                        @{
                                            string title = comment.Article.Title;
                                            if (title.Length > 23)
                                            {
                                                title = title.Substring(0, 23);
                                                title = title + "...";
                                            }
                                        }
                                        <a href="~/Articles/Details/@comment.ArticleID" class="catg_title"> <h5>@title</h5></a>
                                        <br />
                                        @{
                                            string content = comment.Content;
                                            if (content.Length > 23)
                                            {
                                                content = content.Substring(0, 23);
                                                content = content + "...";
                                            }
                                        }
                                        <a href="~/Comments/Details/@comment.CommentID" class="catg_title"> <h6>@content</h6></a>
                                    </div>
                                </div>
                            </li>
                        }
                    </ul>
                </div>

            </aside>
        </div>
    </div>

</section>
